  <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login / Registro</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script>
  function handleLogin(form){
    google.script.run
      .withSuccessHandler(res => {
        if (res && res.ok) {
          sessionStorage.setItem('userEmail', res.user.email || '');
          const url = new URL(window.location.href);
          url.searchParams.set('page', 'index');
          windows.top.location.href = url.toString();
        } else {
          alert(res?.msg || "Usuario o contraseña incorrectos");
        }
      })
      .loginUser(form.email.value, form.pass.value);
  }
</script>
</head>
<body class="d-flex align-items-center justify-content-center vh-100 bg-light">

  <div class="card shadow p-4" style="width: 360px;">
    <h5 class="text-center mb-3">Acceso</h5>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="tabAuth" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#tab-login" type="button" role="tab">Ingresar</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#tab-register" type="button" role="tab">Registrarse</button>
      </li>
    </ul>

    <div class="tab-content">

      <!-- LOGIN -->
      <div class="tab-pane fade show active" id="tab-login" role="tabpanel">
        <form onsubmit="handleLogin(this); return false;">
          <div class="mb-3">
            <input name="email" type="email" class="form-control" placeholder="Correo" required>
          </div>
          <div class="mb-3">
            <input name="pass" type="password" class="form-control" placeholder="Contraseña" required>
          </div>
          <button type="submit" class="btn btn-theme w-100">Ingresar</button>
        </form>
      </div>

      <!-- REGISTRO -->
      <div class="tab-pane fade" id="tab-register" role="tabpanel">
        <form onsubmit="handleRegister(this); return false;">
          <div class="mb-2">
            <input name="name" class="form-control" placeholder="Nombre y apellido" required>
          </div>
          <div class="mb-2">
            <input name="email" type="email" class="form-control" placeholder="Correo" required>
          </div>
          <div class="mb-2">
            <input name="pass1" type="password" class="form-control" placeholder="Contraseña" required>
          </div>
          <div class="mb-3">
            <input name="pass2" type="password" class="form-control" placeholder="Repetir contraseña" required>
          </div>
          <button type="submit" class="btn btn-secondary w-100">Crear cuenta</button>
        </form>
      </div>

    </div>

    <div id="authMsg" class="text-center mt-3 text-danger" style="display:none;"></div>
  </div>

  <script>
    function showMsg(text, ok=false) {
      const el = document.getElementById('authMsg');
      el.classList.toggle('text-danger', !ok);
      el.classList.toggle('text-success', ok);
      el.innerText = text;
      el.style.display = 'block';
      setTimeout(()=> el.style.display='none', 3500);
    }

    function handleRegister(form){
      if (form.pass1.value !== form.pass2.value) {
        showMsg("Las contraseñas no coinciden");
        return;
      }
      google.script.run.withSuccessHandler(res => {
        if (res && res.ok) {
          showMsg("Registrado. Ya puedes iniciar sesión.", true);
          // opcional: cambiar a pestaña login
          document.querySelector('#login-tab').click();
        } else {
          showMsg(res?.msg || "No se pudo registrar");
        }
      }).registerUser(form.name.value, form.email.value, form.pass1.value, "user");
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
